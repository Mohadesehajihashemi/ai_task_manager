from models.agent import TaskAgent
from datetime import datetime

# Initialize the Task Agent
agent = TaskAgent('data/tasks.json')

# Display initial task list
print("=== AI Task Manager ===")
print("Current Tasks:")
for task in agent.tasks:
    suggestion = agent.suggest_priority(task)
    print(f"- {task['title']} (Priority: {task['priority']}, Due: {task['due']}) - Suggestion: {suggestion}")

# Display urgent reminders
print("\nUrgent Reminders:")
urgent_count = 0
for task in agent.tasks:
    if "urgent" in agent.suggest_priority(task):
        print(f"- {task['title']} requires immediate attention!")
        urgent_count += 1
if urgent_count == 0:
    print("No urgent tasks at the moment.")

# Main interaction loop
while True:
    action = input("\nEnter 'add' or 'new' to add a task, or 'exit' to quit: ").strip().lower()
    if action == 'exit':
        print("Thank you for using AI Task Manager. Goodbye!")
        break
    elif action in ['add', 'new']:
        print("Starting task creation process...")
        # Collect task title
        title = ""
        while not title:
            title = input("Enter task title: ").strip()
            if not title:
                print("Error: Task title cannot be empty.")
        # Collect task priority
        priority = ""
        while priority not in ['high', 'medium', 'low']:
            priority = input("Enter priority (high/medium/low): ").strip().lower()
            if priority not in ['high', 'medium', 'low']:
                print("Error: Invalid priority. Please use 'high', 'medium', or 'low'.")
        # Collect task due date
        due = ""
        while True:
            due = input("Enter due date (e.g., 2025-08-01): ").strip()
            try:
                datetime.strptime(due, '%Y-%m-%d')
                break
            except ValueError:
                print("Error: Invalid date format. Please use YYYY-MM-DD (e.g., 2025-08-01).")
        # Add the task and update display
        if agent.add_task(title, priority, due):
            print(f"Success: Task '{title}' added!")
            print("Updated Tasks:")
            for task in agent.tasks:
                suggestion = agent.suggest_priority(task)
                print(f"- {task['title']} (Priority: {task['priority']}, Due: {task['due']}) - Suggestion: {suggestion}")
            print("Urgent Reminders:")
            urgent_count = 0
            for task in agent.tasks:
                if "urgent" in agent.suggest_priority(task):
                    print(f"- {task['title']} requires immediate attention!")
                    urgent_count += 1
            if urgent_count == 0:
                print("No urgent tasks at the moment.")
    else:
        print("Error: Invalid command. Please enter 'add', 'new', or 'exit'.")
